{# Reusable Jinja2 macros for consistent UI components #}

{# Sentiment badge with color coding #}
{% macro sentiment_badge(sentiment, confidence=None, size='md') %}
{% set colors = {
    'positive': 'bg-green-100 text-green-800 border-green-200',
    'negative': 'bg-red-100 text-red-800 border-red-200',
    'neutral': 'bg-gray-100 text-gray-800 border-gray-200'
} %}
{% set sizes = {
    'sm': 'px-2 py-0.5 text-xs',
    'md': 'px-3 py-1 text-sm',
    'lg': 'px-4 py-2 text-base'
} %}
<span class="inline-flex items-center {{ sizes[size] }} rounded-full font-medium border {{ colors.get(sentiment, colors.neutral) }}">
    {{ sentiment|title }}
    {% if confidence is not none %}
        <span class="ml-1 opacity-75">({{ (confidence * 100)|int }}%)</span>
    {% endif %}
</span>
{% endmacro %}

{# Emotion badge with color coding #}
{% macro emotion_badge(emotion, confidence=None, size='md') %}
{% set colors = {
    'joy': 'bg-yellow-100 text-yellow-800 border-yellow-200',
    'anger': 'bg-red-100 text-red-800 border-red-200',
    'fear': 'bg-purple-100 text-purple-800 border-purple-200',
    'sadness': 'bg-blue-100 text-blue-800 border-blue-200',
    'surprise': 'bg-orange-100 text-orange-800 border-orange-200',
    'disgust': 'bg-lime-100 text-lime-800 border-lime-200',
    'neutral': 'bg-gray-100 text-gray-800 border-gray-200'
} %}
{% set sizes = {
    'sm': 'px-2 py-0.5 text-xs',
    'md': 'px-3 py-1 text-sm',
    'lg': 'px-4 py-2 text-base'
} %}
<span class="inline-flex items-center {{ sizes[size] }} rounded-full font-medium border {{ colors.get(emotion, colors.neutral) }}">
    {{ emotion|title }}
    {% if confidence is not none %}
        <span class="ml-1 opacity-75">({{ (confidence * 100)|int }}%)</span>
    {% endif %}
</span>
{% endmacro %}

{# Statistics card #}
{% macro stat_card(title, value, icon=None, color='blue', subtitle=None) %}
<div class="bg-white rounded-xl shadow-lg p-6 flex items-center space-x-4">
    {% if icon %}
    <div class="p-3 bg-{{ color }}-100 rounded-full">
        {{ icon|safe }}
    </div>
    {% endif %}
    <div>
        <p class="text-sm text-gray-500">{{ title }}</p>
        <p class="text-2xl font-bold text-gray-900">{{ value }}</p>
        {% if subtitle %}
        <p class="text-xs text-gray-400 mt-1">{{ subtitle }}</p>
        {% endif %}
    </div>
</div>
{% endmacro %}

{# Progress bar #}
{% macro progress_bar(percent, color='blue', height='h-4', animated=False) %}
<div class="w-full bg-gray-200 rounded-full {{ height }} overflow-hidden">
    <div class="bg-{{ color }}-600 {{ height }} rounded-full transition-all duration-300 {% if animated %}animate-pulse{% endif %}"
         style="width: {{ percent }}%">
    </div>
</div>
{% endmacro %}

{# Score meter (horizontal bar) #}
{% macro score_meter(value, max_value=1, label=None, color='blue') %}
<div class="flex items-center space-x-3">
    {% if label %}
    <span class="text-sm text-gray-600 w-20">{{ label }}</span>
    {% endif %}
    <div class="flex-1 bg-gray-200 rounded-full h-2">
        <div class="bg-{{ color }}-500 h-2 rounded-full transition-all duration-300"
             style="width: {{ (value / max_value * 100)|int }}%">
        </div>
    </div>
    <span class="text-sm text-gray-600 w-12 text-right">{{ (value * 100)|int }}%</span>
</div>
{% endmacro %}

{# Empty state placeholder #}
{% macro empty_state(title, message, icon=None, action_url=None, action_text=None) %}
<div class="text-center py-12">
    {% if icon %}
    <div class="mx-auto h-16 w-16 text-gray-400 mb-4">
        {{ icon|safe }}
    </div>
    {% endif %}
    <h3 class="text-lg font-medium text-gray-900 mb-2">{{ title }}</h3>
    <p class="text-gray-500 mb-6 max-w-md mx-auto">{{ message }}</p>
    {% if action_url and action_text %}
    <a href="{{ action_url }}"
       class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
        {{ action_text }}
    </a>
    {% endif %}
</div>
{% endmacro %}

{# Pagination controls #}
{% macro pagination(pagination_obj, endpoint, **kwargs) %}
{% if pagination_obj.pages > 1 %}
<nav class="flex items-center justify-between border-t border-gray-200 px-4 py-3 sm:px-6">
    <div class="hidden sm:flex sm:flex-1 sm:items-center sm:justify-between">
        <div>
            <p class="text-sm text-gray-700">
                Showing
                <span class="font-medium">{{ ((pagination_obj.page - 1) * pagination_obj.per_page) + 1 }}</span>
                to
                <span class="font-medium">{{ min(pagination_obj.page * pagination_obj.per_page, pagination_obj.total) }}</span>
                of
                <span class="font-medium">{{ pagination_obj.total }}</span>
                results
            </p>
        </div>
        <div>
            <ul class="flex items-center space-x-1">
                {% if pagination_obj.has_prev %}
                <li>
                    <a href="{{ url_for(endpoint, page=pagination_obj.prev_num, **kwargs) }}"
                       class="px-3 py-2 text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50">
                        Previous
                    </a>
                </li>
                {% endif %}

                {% for page_num in pagination_obj.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
                    {% if page_num %}
                        <li>
                            <a href="{{ url_for(endpoint, page=page_num, **kwargs) }}"
                               class="px-3 py-2 {% if page_num == pagination_obj.page %}bg-blue-600 text-white{% else %}text-gray-500 bg-white hover:bg-gray-50{% endif %} border border-gray-300 rounded-md">
                                {{ page_num }}
                            </a>
                        </li>
                    {% else %}
                        <li><span class="px-3 py-2 text-gray-500">...</span></li>
                    {% endif %}
                {% endfor %}

                {% if pagination_obj.has_next %}
                <li>
                    <a href="{{ url_for(endpoint, page=pagination_obj.next_num, **kwargs) }}"
                       class="px-3 py-2 text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50">
                        Next
                    </a>
                </li>
                {% endif %}
            </ul>
        </div>
    </div>
</nav>
{% endif %}
{% endmacro %}

{# Form field with label and errors #}
{% macro form_field(field, label=None) %}
<div class="mb-4">
    {% if label %}
    <label for="{{ field.id }}" class="block text-sm font-medium text-gray-700 mb-1">
        {{ label }}
        {% if field.flags.required %}<span class="text-red-500">*</span>{% endif %}
    </label>
    {% endif %}
    {{ field }}
    {% if field.errors %}
    <ul class="mt-1 text-sm text-red-600">
        {% for error in field.errors %}
        <li>{{ error }}</li>
        {% endfor %}
    </ul>
    {% endif %}
</div>
{% endmacro %}

{# Loading spinner #}
{% macro spinner(size='md', color='blue') %}
{% set sizes = {'sm': 'h-4 w-4', 'md': 'h-8 w-8', 'lg': 'h-12 w-12'} %}
<svg class="animate-spin {{ sizes[size] }} text-{{ color }}-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
</svg>
{% endmacro %}

{# Timestamp display #}
{% macro timestamp(dt, format='relative') %}
{% if dt %}
<time datetime="{{ dt.isoformat() }}" title="{{ dt.strftime('%Y-%m-%d %H:%M:%S UTC') }}">
    {% if format == 'relative' %}
        {{ dt|timedelta_human if dt|timedelta_human is defined else dt.strftime('%b %d, %Y') }}
    {% else %}
        {{ dt.strftime('%b %d, %Y at %H:%M') }}
    {% endif %}
</time>
{% else %}
<span class="text-gray-400">-</span>
{% endif %}
{% endmacro %}

{# Confirmation dialog (requires JS) #}
{% macro confirm_button(text, url, method='POST', confirm_message='Are you sure?', btn_class='bg-red-600 text-white hover:bg-red-700') %}
<form action="{{ url }}" method="POST" class="inline"
      onsubmit="return confirm('{{ confirm_message }}');">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <button type="submit" class="px-4 py-2 rounded-lg {{ btn_class }} transition-colors">
        {{ text }}
    </button>
</form>
{% endmacro %}
